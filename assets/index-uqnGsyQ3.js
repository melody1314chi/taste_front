import{aj as T,a5 as B,c as I,ak as M,h as c,j as N,s as j,k as x,al as A,f as y,o as g,w as r,d as i,am as O,b as D,U as W,an as E,F as P,r as $,ao as G,ad as U,_ as q,S as F,T as b,ap as J,aq as L}from"./index-BJ5mKrdB.js";import{V as z}from"./VRow-C-TIxZZV.js";import{V}from"./VCol-BTinVxch.js";import{V as H}from"./VContainer-D9u67iRf.js";function K(t){return T()?(B(t),!0):!1}const Q=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const X=t=>t!=null,_=()=>{};function Y(t){return Array.isArray(t)?t:[t]}const Z=Q?window:void 0;function k(t){var a;const n=M(t);return(a=n==null?void 0:n.$el)!=null?a:n}function ee(){const t=j(!1),a=A();return a&&x(()=>{t.value=!0},a),t}function te(t){const a=ee();return I(()=>(a.value,!!t()))}function oe(t,a,n={}){const{root:u,rootMargin:v="0px",threshold:l=0,window:d=Z,immediate:m=!0}=n,h=te(()=>d&&"IntersectionObserver"in d),w=I(()=>{const p=M(t);return Y(p).map(k).filter(X)});let e=_;const o=c(m),s=h.value?N(()=>[w.value,k(u),o.value],([p,R])=>{if(e(),!o.value||!p.length)return;const C=new IntersectionObserver(a,{root:k(R),rootMargin:v,threshold:l});p.forEach(S=>S&&C.observe(S)),e=()=>{C.disconnect(),e=_}},{immediate:m,flush:"post"}):_,f=()=>{e(),s(),o.value=!1};return K(f),{isSupported:h,isActive:o,pause(){e(),o.value=!1},resume(){o.value=!0},stop:f}}const ae={style:{width:"100%"},class:"d-flex justify-start"},ie={__name:"index",setup(t){const a=c([]),n=c(1),u=c(!0),v=c(null),l=c([]);x(async()=>{await d(),m(),h()});const d=async()=>{try{console.log("開始取得食譜資料...");const e=await fetch(`http://localhost:4000/recipeAPI/getPasta?page=${n.value}`);console.log("取得食譜資料成功!");const o=await e.json();console.log("前端收到的資料:",o),o.result.length>0?(a.value=[...a.value,...o.result.map(s=>({...s,isFavorite:l.value.some(f=>f.id===s.id)}))],n.value+=1):u.value=!1}catch(e){console.error("取得食譜資料失敗:",e)}},m=()=>{oe(v,([{isIntersecting:e}])=>{e&&u.value&&d()},{threshold:.5})},h=async()=>{try{const o=await(await fetch("http://localhost:4000/favoriteRecipes")).json();l.value=o}catch(e){console.error("無法載入收藏食譜:",e)}},w=e=>{e.isFavorite=!e.isFavorite,e.isFavorite?l.value.push(e):l.value=l.value.filter(o=>o.id!==e.id),localStorage.setItem("favoriteRecipes",JSON.stringify(l.value))};return(e,o)=>(g(),y(H,null,{default:r(()=>[i(z,null,{default:r(()=>[O("div",ae,[i(V,{cols:"6"},{default:r(()=>[i(E,{modelValue:e.search,"onUpdate:modelValue":o[0]||(o[0]=s=>e.search=s),"prepend-inner-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1})]),(g(!0),D(P,null,$(a.value,(s,f)=>(g(),y(V,{key:s.id,cols:"3"},{default:r(()=>[i(G,null,{default:r(()=>[i(U,{src:s.image,class:"image",cover:""},{default:r(()=>[i(q,{class:"add-favorite-icon",onClick:p=>w(s)},{default:r(()=>[F(b(s.isFavorite?"mdi-heart":"mdi-heart-plus-outline"),1)]),_:2},1032,["onClick"])]),_:2},1032,["src"]),i(J,null,{default:r(()=>[F(b(s.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),u.value?(g(),y(V,{key:0,ref_key:"loadMoreTrigger",ref:v,cols:"12"},{default:r(()=>[i(L,{indeterminate:"",color:"primary"})]),_:1},512)):W("",!0)]),_:1})]),_:1}))}};export{ie as default};
